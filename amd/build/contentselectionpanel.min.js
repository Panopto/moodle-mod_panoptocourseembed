define(["jquery","core/notification","core/modal_factory","core/str"],(d,s,t,l)=>{let r=null,n=!1;var i=(e,o,i)=>{Promise.all([l.get_string("selectvideo","panoptocourseembed"),t.create({type:t.types.DEFAULT,body:`<iframe class="mod-panoptocourseembed-iframe-custom" src="${e}" frameborder="0"></iframe>`,large:!0})]).then(([e,t])=>{t.setTitle(e),t.getRoot().addClass("mod-panoptocourseembed-modal-custom-size"),t.getRoot().find(".modal-dialog").addClass("mod-panoptocourseembed-modal-dialog-custom").css({width:i+"px","max-width":i+"px"}),t.getRoot().find(".modal-content").addClass("mod-panoptocourseembed-modal-content-custom").css({height:o+"px","max-height":o+"px"}),t.getRoot().find(".modal-body").addClass("mod-panoptocourseembed-modal-body-custom"),t.show(),document.body.panoptoWindow=t,document.body.addEventListener("sessionSelected",a.bind(this),!1)}).catch(s.exception)},a=e=>{var t=new URL(e.detail.ltiViewerUrl),o=t.searchParams;o.set("course",r),o.set("custom",decodeURI(e.detail.customData)),o.set("contentUrl",e.detail.contentUrl),o.set("resourcelinkid",createResourceLinkId()),t.search=o.toString();let i;o=e.detail.width??800,e=e.detail.height??600;i=n?'<p><iframe src="'+t.toString()+'" style="width:100%; height:auto; aspect-ratio: '+o+" / "+e+';" allowfullscreen="true"></iframe><br /></p>':'<p><iframe src="'+t.toString()+'" width="'+o+'" height="'+e+'" allowfullscreen="true"></iframe><br /></p>',d("input[name=intro]").val(i),d("#panopto-intro-preview").html(i),l.get_string("replacevideo","panoptocourseembed").done(e=>{d("#id_select_video").val(e)}).fail(s.exception),d("#id_select_video").addClass("btn-secondary").removeClass("btn-primary"),document.body.panoptoWindow.destroy()};return{initselectionpanel:a=>{var e,t,o;"0"!==a.folderviewbtnid&&"0"!==a.selectvidbtnid&&"0"!==a.lticimlaunchurl&&"0"!==a.ltilaunchurl&&0!==a.courseid&&0!==a.height&&0!==a.width&&0!==a.isresponsive&&(r=a.courseid,n=a.isresponsive,e=d("#"+a.selectvidbtnid),t=d("#"+a.folderviewbtnid),e.on("click",()=>{i(a.lticimlaunchurl,a.height,a.width)}),t.on("click",()=>{{var o=a.ltilaunchurl,i=600,r=800;let e=new URL(o),t;t=n?'<p><iframe src="'+e.toString()+'" style="width:100%; height:auto; aspect-ratio: '+r+" / "+i+';" allowfullscreen="true"></iframe><br /></p>':'<p><iframe src="'+e.toString()+'" width="'+r+'" height="'+i+'" allowfullscreen="true"></iframe><br /></p>',d("input[name=intro]").val(t),d("#panopto-intro-preview").html(t),l.get_string("selectvideo","panoptocourseembed").done(e=>{d("#id_select_video").val(e)}).fail(s.exception),d("#id_select_video").removeClass("btn-secondary").addClass("btn-primary")}}),createResourceLinkId=(o=a.resourcebase,()=>o+"_"+(new Date).getTime()))}}});